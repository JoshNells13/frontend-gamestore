import{u as E,l as I,c as r,a as t,F as j,m as q,t as n,w as M,k as _,d as C,v as U,n as D,b as G,p as m,j as L,r as i,h as P,i as R,o as u,f as Z,g as H}from"./index-BKCWGQCp.js";const J={class:"list-form py-5"},K={class:"container"},O={key:0,class:"text-center py-4"},Q={key:1,class:"table table-striped"},W=["src","alt"],X=["onClick"],Y=["onClick"],tt=["onClick"],et={class:"modal fade",id:"gameModal",tabindex:"-1"},st={class:"modal-dialog"},at={class:"modal-content"},lt={class:"modal-header"},ot={class:"modal-title"},nt={class:"modal-body"},it={class:"mb-3"},dt={key:0,class:"invalid-feedback"},rt={class:"mb-3"},ut={key:0,class:"invalid-feedback"},ct={class:"text-end"},mt=["disabled"],pt={class:"modal fade",id:"uploadModal",tabindex:"-1"},vt={class:"modal-dialog"},bt={class:"modal-content"},ft={class:"modal-header"},ht={class:"modal-title"},yt={class:"modal-body"},_t={class:"mb-3"},gt={class:"text-end"},wt=["disabled"],Mt={__name:"ManageGames",setup(kt){const g=E(),F=L(),k=i([]),w=i(!0),p=i(!1),v=i(!1),b=i(!1),l=i(null),c=i(null),o=P({title:"",description:""}),f=i(null);let d=null,h=null;const y=async()=>{w.value=!0;try{const s=await m.get(`/v1/users/${g.user.username}`);k.value=s.data.authored_games||[]}catch(s){console.error("Failed to fetch authored games",s)}finally{w.value=!1}},$=()=>{b.value=!1,o.title="",o.description="",l.value=null,d||(d=new bootstrap.Modal(document.getElementById("gameModal"))),d.show()},B=s=>{b.value=!0,c.value=s,o.title=s.title,o.description=s.description,l.value=null,d||(d=new bootstrap.Modal(document.getElementById("gameModal"))),d.show()},T=s=>{c.value=s,f.value=null,h||(h=new bootstrap.Modal(document.getElementById("uploadModal"))),h.show()},V=async()=>{p.value=!0,l.value=null;try{b.value?await m.put(`/v1/games/${c.value.slug}`,o):await m.post("/v1/games",o),d.hide(),y()}catch(s){s.response?.status===400&&(l.value=s.response.data.violations)}finally{p.value=!1}},A=s=>{f.value=s.target.files[0]},S=async()=>{if(!f.value)return;v.value=!0;const s=new FormData;s.append("zipfile",f.value),s.append("token",g.token);try{await m.post(`/v1/games/${c.value.slug}/upload`,s,{headers:{"Content-Type":"multipart/form-data"}}),h.hide(),y()}catch(e){alert(e.response?.data?.message||"Upload failed")}finally{v.value=!1}},N=async s=>{if(confirm("Are you sure you want to delete this game? This action cannot be undone."))try{await m.delete(`/v1/games/${s}`),y()}catch(e){alert(e.response?.data?.message||"Delete failed")}};return I(()=>{g.user?y():F.push("/login")}),(s,e)=>{const z=R("router-link");return u(),r("main",null,[t("div",{class:"hero py-5 bg-light"},[t("div",{class:"container"},[t("button",{onClick:$,class:"btn btn-primary"}," Add Game ")])]),t("div",J,[t("div",K,[e[5]||(e[5]=t("h6",{class:"mb-3"},"List Games",-1)),w.value?(u(),r("div",O,[...e[2]||(e[2]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)])])):(u(),r("table",Q,[e[4]||(e[4]=t("thead",null,[t("tr",null,[t("th",{width:"100"},"Thumbnail"),t("th",{width:"200"},"Title"),t("th",{width:"500"},"Description"),t("th",{width:"250"},"Action")])],-1)),t("tbody",null,[(u(!0),r(j,null,q(k.value,a=>(u(),r("tr",{key:a.slug},[t("td",null,[t("img",{src:a.thumbnail||"/example_game/v1/thumbnail.png",alt:a.title,class:"img-fluid rounded"},null,8,W)]),t("td",null,n(a.title),1),t("td",null,n(a.description),1),t("td",null,[Z(z,{to:`/game/${a.slug}`,class:"btn btn-sm btn-primary mb-1"},{default:H(()=>[...e[3]||(e[3]=[_("Detail",-1)])]),_:1},8,["to"]),t("button",{onClick:x=>B(a),class:"btn btn-sm btn-secondary ms-1 mb-1"},"Update",8,X),t("button",{onClick:x=>T(a),class:"btn btn-sm btn-info ms-1 mb-1 text-white"},"Upload",8,Y),t("button",{onClick:x=>N(a.slug),class:"btn btn-sm btn-danger ms-1 mb-1"},"Delete",8,tt)])]))),128))])]))])]),t("div",et,[t("div",st,[t("div",at,[t("div",lt,[t("h5",ot,n(b.value?"Update Game":"Add Game"),1),e[6]||(e[6]=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1))]),t("div",nt,[t("form",{onSubmit:M(V,["prevent"])},[t("div",it,[e[7]||(e[7]=t("label",{class:"form-label"},[_("Title "),t("span",{class:"text-danger"},"*")],-1)),C(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>o.title=a),type:"text",class:D(["form-control",{"is-invalid":l.value?.title}]),required:""},null,2),[[U,o.title]]),l.value?.title?(u(),r("div",dt,n(l.value.title.join(", ")),1)):G("",!0)]),t("div",rt,[e[8]||(e[8]=t("label",{class:"form-label"},[_("Description "),t("span",{class:"text-danger"},"*")],-1)),C(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.description=a),class:D(["form-control",{"is-invalid":l.value?.description}]),rows:"3",required:""},null,2),[[U,o.description]]),l.value?.description?(u(),r("div",ut,n(l.value.description.join(", ")),1)):G("",!0)]),t("div",ct,[e[9]||(e[9]=t("button",{type:"button",class:"btn btn-secondary me-2","data-bs-dismiss":"modal"},"Cancel",-1)),t("button",{type:"submit",class:"btn btn-primary",disabled:p.value},n(p.value?"Saving...":"Save"),9,mt)])],32)])])])]),t("div",pt,[t("div",vt,[t("div",bt,[t("div",ft,[t("h5",ht,"Upload New Version - "+n(c.value?.title),1),e[10]||(e[10]=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1))]),t("div",yt,[t("form",{onSubmit:M(S,["prevent"])},[t("div",_t,[e[11]||(e[11]=t("label",{class:"form-label"},[_("Game ZIP File "),t("span",{class:"text-danger"},"*")],-1)),t("input",{type:"file",onChange:A,class:"form-control",accept:".zip",required:""},null,32),e[12]||(e[12]=t("small",{class:"text-muted"},"Max size: 100MB",-1))]),t("div",gt,[e[13]||(e[13]=t("button",{type:"button",class:"btn btn-secondary me-2","data-bs-dismiss":"modal"},"Cancel",-1)),t("button",{type:"submit",class:"btn btn-primary",disabled:v.value},n(v.value?"Uploading...":"Upload"),9,wt)])],32)])])])])])}}};export{Mt as default};
