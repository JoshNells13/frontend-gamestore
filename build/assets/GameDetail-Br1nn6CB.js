import{u as V,l as C,q as D,c as o,a as e,t as r,f as w,g as x,b as l,F as k,m as T,k as u,x as $,p,r as g,i as E,z as L,o as n,n as G,e as B}from"./index-BKCWGQCp.js";const P={key:0},z={class:"hero py-5 bg-light"},M={class:"container text-center"},R={class:"mb-1"},Y={class:"text-muted mt-2"},j={key:0,class:"mt-2"},q={class:"py-5"},A={class:"container"},O={class:"row"},U={class:"col-lg-8"},H={class:"ratio ratio-16x9 shadow rounded mb-4 overflow-hidden"},J=["src"],K={class:"col-lg-4"},Q={class:"card mb-3 shadow-sm"},W={class:"card-body"},X={key:0,class:"list-group list-group-numbered"},Z={class:"ms-2 me-auto"},ee={key:0,class:"badge bg-info text-dark ms-1"},se={class:"badge bg-primary rounded-pill"},te={class:"ps-4"},ae={class:"fw-bold"},oe={class:"badge bg-primary rounded-pill float-end"},ne={key:2,class:"text-muted text-center py-3"},re={class:"text-center"},le=["src"],de=["href"],ce={key:1,class:"text-center py-5"},me={__name:"GameDetail",setup(ie){const F=$(),c=V(),a=g(null),d=g([]),b=g(!0);let m=null;const _=F.params.slug,I=async()=>{try{const s=await p.get(`/v1/games/${_}`);a.value=s.data.game}catch(s){console.error("Failed to fetch game",s)}finally{b.value=!1}},v=async()=>{try{const s=await p.get(`/v1/games/${_}/scores`);d.value=s.data.scores||[]}catch(s){console.error("Failed to fetch scores",s)}},N=L(()=>d.value.slice(0,10)),h=L(()=>{if(!c.user)return null;const s=d.value.findIndex(t=>t.username===c.user.username);return s>=10?d.value[s]:null}),f=async s=>{if(s.data&&s.data.type==="score")try{await p.post(`/v1/games/${_}/scores`,{score:s.data.value}),v()}catch(t){console.error("Failed to post score",t)}};return C(()=>{I(),v(),m=setInterval(v,5e3),window.addEventListener("message",f)}),D(()=>{m&&clearInterval(m),window.removeEventListener("message",f)}),(s,t)=>{const y=E("router-link");return a.value?(n(),o("main",P,[e("div",z,[e("div",M,[e("h2",R,r(a.value.title),1),w(y,{to:`/profile/${a.value.author}`,class:"btn btn-success"},{default:x(()=>[u("By "+r(a.value.author),1)]),_:1},8,["to"]),e("div",Y,r(a.value.description),1),a.value.version?(n(),o("h5",j,"Last Version "+r(a.value.version)+" ("+r(a.value.last_updated_at)+")",1)):l("",!0)])]),e("div",q,[e("div",A,[e("div",O,[e("div",U,[e("div",H,[e("iframe",{src:a.value.gamePath,frameborder:"0",allowfullscreen:""},null,8,J)])]),e("div",K,[e("div",Q,[e("div",W,[t[2]||(t[2]=e("h5",{class:"card-title mb-3"},"Top 10 Leaderboard",-1)),d.value.length>0?(n(),o("ol",X,[(n(!0),o(k,null,T(N.value,(i,S)=>(n(),o("li",{key:S,class:"list-group-item d-flex justify-content-between align-items-start border-0 ps-0"},[e("div",Z,[e("span",{class:G({"fw-bold":i.username===B(c).user?.username})},[u(r(i.username)+" ",1),i.username===B(c).user?.username?(n(),o("span",ee,"(You)")):l("",!0)],2)]),e("span",se,r(i.score),1)]))),128))])):l("",!0),h.value?(n(),o(k,{key:1},[t[1]||(t[1]=e("hr",null,null,-1)),e("div",te,[e("span",ae,[u(r(h.value.username)+" ",1),t[0]||(t[0]=e("span",{class:"badge bg-info text-dark ms-1"},"(You)",-1))]),e("span",oe,r(h.value.score),1)])],64)):l("",!0),d.value.length===0?(n(),o("div",ne," No scores submitted yet ")):l("",!0)])]),e("div",re,[e("img",{src:a.value.thumbnail||"/example_game/v1/thumbnail.png",alt:"Thumbnail",class:"img-fluid rounded shadow-sm mb-3"},null,8,le),a.value.downloadPath?(n(),o("a",{key:0,href:a.value.downloadPath,class:"btn btn-primary w-100 mb-2"},"Download Game",8,de)):l("",!0),w(y,{to:"/discover",class:"btn btn-danger w-100"},{default:x(()=>[...t[3]||(t[3]=[u("Back",-1)])]),_:1})])])])])])])):b.value?(n(),o("div",ce,[...t[4]||(t[4]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)])])):l("",!0)}}};export{me as default};
