import{l as L,c as n,a as s,F,m as S,t as i,w as V,d as C,v as U,n as h,b as f,p as u,r as b,h as A,i as B,o as l,f as D,g as N,k as j}from"./index-BKCWGQCp.js";const E={class:"hero py-5 bg-light"},T={class:"container"},z={class:"list-form py-5"},I={class:"container"},O={key:0,class:"text-center py-4"},P={key:1,class:"table table-striped"},q={key:0,class:"btn-group",role:"group"},G={class:"dropdown-menu"},H=["onClick"],J=["onClick"],K=["onClick"],Q=["onClick"],R=["onClick"],W=["onClick"],X={class:"modal fade",id:"userModal",tabindex:"-1"},Y={class:"modal-dialog"},Z={class:"modal-content"},ss={class:"modal-header"},es={class:"modal-title"},ts={class:"modal-body"},os={class:"mb-3"},as=["disabled"],ns={key:0,class:"invalid-feedback"},ls={class:"mb-3"},ds={key:0,class:"invalid-feedback"},is={key:1,class:"text-muted"},rs={class:"text-end"},us=["disabled"],bs={__name:"UserList",setup(cs){const w=b([]),_=b(!0),p=b(!1),r=b(!1),d=b(null),a=A({username:"",password:""});let v=null;const c=async()=>{_.value=!0;try{const t=await u.get("/v1/users");w.value=t.data.users}catch(t){console.error("Failed to fetch users",t)}finally{_.value=!1}},g=(t=null)=>{d.value=null,t?(r.value=!0,a.username=t.username,a.password=""):(r.value=!1,a.username="",a.password=""),v||(v=new bootstrap.Modal(document.getElementById("userModal"))),v.show()},$=async()=>{p.value=!0,d.value=null;try{if(r.value){const t={...a};t.password||delete t.password,await u.put(`/v1/users/${a.username}`,t)}else await u.post("/v1/users",a);v.hide(),c()}catch(t){t.response?.status===400&&(d.value=t.response.data.violations)}finally{p.value=!1}},k=async(t,e)=>{try{await u.post(`/v1/users/${t}/block`,{reason:e}),c()}catch(y){alert(y.response?.data?.message||"Failed to block user")}},x=async t=>{try{await u.post(`/v1/users/${t}/unblock`),c()}catch(e){alert(e.response?.data?.message||"Failed to unblock user")}},M=async t=>{if(confirm(`Are you sure you want to delete user ${t}?`))try{await u.delete(`/v1/users/${t}`),c()}catch(e){alert(e.response?.data?.message||"Failed to delete user")}};return L(c),(t,e)=>{const y=B("router-link");return l(),n("main",null,[s("div",E,[s("div",T,[s("button",{onClick:e[0]||(e[0]=o=>g()),class:"btn btn-primary"}," Add User ")])]),s("div",z,[s("div",I,[e[6]||(e[6]=s("h6",{class:"mb-3"},"List Users",-1)),_.value?(l(),n("div",O,[...e[3]||(e[3]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1)])])):(l(),n("table",P,[e[5]||(e[5]=s("thead",null,[s("tr",null,[s("th",null,"Username"),s("th",null,"Created at"),s("th",null,"Last login"),s("th",null,"Status"),s("th",null,"Action")])],-1)),s("tbody",null,[(l(!0),n(F,null,S(w.value,o=>(l(),n("tr",{key:o.username},[s("td",null,[D(y,{to:`/profile/${o.username}`,target:"_blank"},{default:N(()=>[j(i(o.username),1)]),_:2},1032,["to"])]),s("td",null,i(o.created_at),1),s("td",null,i(o.last_login_at),1),s("td",null,[s("span",{class:h([o.is_blocked?"bg-danger":"bg-success","text-white p-1 d-inline-block"])},i(o.is_blocked?"Blocked":"Active"),3)]),s("td",null,[o.is_blocked?(l(),n("button",{key:1,onClick:m=>x(o.username),class:"btn btn-primary btn-sm"},"Unlock",8,Q)):(l(),n("div",q,[e[4]||(e[4]=s("button",{type:"button",class:"btn btn-primary btn-sm dropdown-toggle","data-bs-toggle":"dropdown"}," Lock ",-1)),s("ul",G,[s("li",null,[s("button",{onClick:m=>k(o.username,"spamming"),class:"dropdown-item"},"Spamming",8,H)]),s("li",null,[s("button",{onClick:m=>k(o.username,"cheating"),class:"dropdown-item"},"Cheating",8,J)]),s("li",null,[s("button",{onClick:m=>k(o.username,"other"),class:"dropdown-item"},"Other",8,K)])])])),s("button",{onClick:m=>g(o),class:"btn btn-sm btn-secondary ms-1"},"Update",8,R),s("button",{onClick:m=>M(o.username),class:"btn btn-sm btn-danger ms-1"},"Delete",8,W)])]))),128))])]))])]),s("div",X,[s("div",Y,[s("div",Z,[s("div",ss,[s("h5",es,i(r.value?"Update User":"Add User"),1),e[7]||(e[7]=s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1))]),s("div",ts,[s("form",{onSubmit:V($,["prevent"])},[s("div",os,[e[8]||(e[8]=s("label",{class:"form-label"},"Username",-1)),C(s("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>a.username=o),type:"text",class:h(["form-control",{"is-invalid":d.value?.username}]),disabled:r.value},null,10,as),[[U,a.username]]),d.value?.username?(l(),n("div",ns,i(d.value.username.join(", ")),1)):f("",!0)]),s("div",ls,[e[9]||(e[9]=s("label",{class:"form-label"},"Password",-1)),C(s("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>a.password=o),type:"password",class:h(["form-control",{"is-invalid":d.value?.password}])},null,2),[[U,a.password]]),d.value?.password?(l(),n("div",ds,i(d.value.password.join(", ")),1)):f("",!0),r.value?(l(),n("small",is,"Leave blank to keep current password")):f("",!0)]),s("div",rs,[e[10]||(e[10]=s("button",{type:"button",class:"btn btn-secondary me-2","data-bs-dismiss":"modal"},"Cancel",-1)),s("button",{type:"submit",class:"btn btn-primary",disabled:p.value},i(p.value?"Saving...":"Save"),9,us)])],32)])])])])])}}};export{bs as default};
